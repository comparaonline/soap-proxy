<!doctype html>
<html>
  <head>
    <title>WebService proxy</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li.message { padding: 5px 10px; }
      #messages li.message:nth-child(odd) { background: #eee; }
      pre { margin-left: 30px; display: none;}
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/vkbeautify.js"></script>
    <script>

      (function($) {
          $.fn.goTo = function() {
              $('html, body').animate({
                  scrollTop: $(this).offset().top + 'px'
              }, 'fast');
              return this; // for chaining...
          }
      })(jQuery);
      var socket = io();

      function getHeaders(headers) {
        var i, $ul;

        $table = $('<table class="headers">');
        for (i in headers) {
          $table.append(
            $('<tr>')
              .append($('<td>').append($('<strong>').text(i)))
              .append($('<td>').text(headers[i]))
          );
        }
        return $table;
      }

      function showBody() {
        return $('<div>').append(
          $('<a href="#">').text('Body').click(function (e) {
            e.preventDefault();
            $($(this).parent()).next('.xml-body').toggle();
          })
        );
      }
      function addMessage(id, type, data) {
        var $elem = $('#' + id), $main;
        if (!$elem.length) {
          $elem = $('<li class="message">')
            .attr('id', id)
            .appendTo($('#messages'));
        }
        $main = $('<div>')
            .attr('class', type)
            .appendTo($elem);

        switch (type) {
          case 'incoming':
            $main
              .append(getHeaders(data.headers))
              .append(showBody())
              .append($('<pre class="xml-body">').text(vkbeautify.xml(data.body)));
            break;
          case 'outgoing':
            $main
              .append($('<div class="title">').text(data.options.headers.soapaction))
              .append(getHeaders(data.options.headers))
              .append(showBody())
              .append($('<pre class="xml-body">').text(vkbeautify.xml(data.body)));
            break;
        }
        $main.goTo();
      }


      socket.on('incoming', function (data) {
        addMessage(data.id, 'incoming', data);
      });
      socket.on('outgoing', function (data) {
        addMessage(data.id, 'outgoing', data);
      });
    </script>
  </head>
  <body>
    <ul id="messages"></ul>
  </body>
</html>